#!/bin/sh

usage() {
  echo ""
  echo "Usage: bldw project webPropFile [-publishDocs]"
  echo ""
  echo "Example:  bldw GiardiaDBWebsite project_home/webapp.prop"
  echo ""
  echo "  calls 'build GiardiaDBWebsite webinstall -append -webPropFile project_home/webapp.prop'"
  echo ""
  echo "The -publishDocs flag, if present, will be passed to build as well"
  exit 1
}

if [ "$#" != "2" ]; then
  if [ "$3" != "-publishDocs" ]; then
    usage
  elif [ "$#" != "3" ]; then
    usage
  fi
fi

webPropFile=$2
if [ "$2" = "-default" ]; then
  # ensure output webPropFile has a place to live
  gusHomeParent="$GUS_HOME/.."
  mkdir -p $gusHomeParent/etc

  # define locations
  webPropTemplate=$(dirname "$0")/../config/webapp.prop.tmpl
  webPropFile=$gusHomeParent/etc/webapp.prop.generated

  # make default webPropFile from the template
  sed "s|<siteDir>|$gusHomeParent|g" $webPropTemplate > $webPropFile
  echo "Will use generated webPropFile: $webPropFile"
fi

build $1 webinstall -installConfigFile -append -webPropFile $webPropFile $3
